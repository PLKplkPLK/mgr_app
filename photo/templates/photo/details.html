{% extends 'photo/base.html' %}

{% block content %}
<div class="div-whole">
    <div class="card-main">
        <div class="card-inner">
            {% if prediction_1 %}
            <h2 class="card-title text-xl">{{ prediction_1 }}</h2>
            {% else %}
            <p>WystƒÖpi≈Ç b≈ÇƒÖd podczas klasyfikacji.</p>
            {% endif %}

            <div class="flex flex-col">
                <p class="right-2 text-stone-600 text-sm self-end">{{photo.upload_time}}</p>
                <img class="my-2 rounded-xs" src="{{ photo.image.url }}" id="image" alt="Twoje zdjƒôcie">
            </div>

            {% if photo.owner == user %}
            <div class="flex justify-evenly w-full mb-4">
                <form method="post" action="{% url 'photo:toggle_photo_privacy' photo.uuid %}">
                    {% csrf_token %}
                    <button class='btn-second' type="submit">
                        {% if photo.is_private %}üîí Prywatne{% else %}üîì Publiczne{% endif %}
                    </button>
                </form>

                <form method="post" action="{% url 'photo:delete_photo' photo.uuid %}" onsubmit="return confirm('Jeste≈õ pewien, ≈ºe chcesz usunƒÖƒá zdjƒôcie?');">
                    {% csrf_token %}
                    <button class='btn-second' type="submit">üóëÔ∏è</button>
                </form>

                <form method="post" action="{% url 'photo:toggle_review' photo.uuid %}">
                    {% csrf_token %}
                    <button class='btn-second mb-4' type="submit">
                        {% if photo.review_status != 1 %}üìã Sprawd≈∫{% else %}‚úÖ Sprawdzone{% endif %}
                    </button>
                </form>
            </div>
            {% endif %}

            <div class="divider"></div>

            {% if photo.review_status == 0 %}
                Zdjƒôcie nie by≈Ço sprawdzane.
            {% elif photo.review_status == 1 and photo.is_private %}
                <p style="color: red">Zdjƒôcie musi byƒá publiczne, aby mog≈Ço byƒá sprawdzone przez innych u≈ºytkownik√≥w</p>
            {% else %}
                {% if photo.review_status == 1 %}
                    <form class="mb-4" method="post" action="{% url 'photo:post_review' photo.uuid %}">
                        {% csrf_token %}
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">W≈Ça≈õciciel zdjƒôcia chce twojej pomocy w weryfikacji zwierzƒôcia</legend>
                            {{ post_review_form }}
                        </fieldset>

                        <div class="flex justify-end">
                            <button class="btn-second" type="submit">Dodaj</button>
                        </div>
                    </form>
                {% endif %}

                {% if reviews %}
                    {% for review in reviews %}
                        <div class="review bg-base-100 shadow-md rounded-md p-4 space-y-4 border border-base-200 w-100">
                            <div class="review_upper flex justify-between items-start text-sm text-base-content">
                                <div>
                                    <span class="font-semibold">{{ review.owner.username }}</span>
                                    <span class="text-xs text-base-content/70 ml-2">{{ review.upload_time }}</span>
                                    {% if review.helpful %}
                                        <span class="ml-2 badge badge-success text-xs" title="Komentarz oznaczony, jako pomocny">‚úÖ</span>
                                    {% endif %}
                                </div>

                                <div class="flex gap-2 items-center">
                                    {% if photo.owner == user %}
                                        <form method="post" action="{% url 'photo:toggle_helpful' review.id %}">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-xs btn-outline btn-success ml-2">
                                                {% if review.helpful %}
                                                    ‚úÖ Odznacz
                                                {% else %}
                                                    üü© Pomocny
                                                {% endif %}
                                            </button>
                                        </form>
                                    {% endif %}

                                    {% if review.owner == user %}
                                        <form method="post" action="{% url 'photo:delete_review' review.id %}" onsubmit="return confirm('Jeste≈õ pewien, ≈ºe chcesz usunƒÖƒá ten komentarz?');">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-xs btn-outline btn-error">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="review_main prose max-w-none text-base">
                                {{ review.review }}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}